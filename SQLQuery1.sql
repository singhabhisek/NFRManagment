select ApplicationName, transactionNames, releaseID, SLA, TotalSyncSLA, MaxAsyncSLA, backendCall,
CASE WHEN TotalSyncSLA + MaxAsyncSLA = 0 then 'NA' ELSE CASE WHEN SLA > TotalSyncSLA + MaxAsyncSLA then 'Higher' else 'Lower' END END as 'Compare' FROM (

SELECT ApplicationName, transactionNames, releaseID, SLA, backendCall, SUM( CASE WHEN CallType = 'Sync' THEN SLAComparison ELSE 0 END ) OVER (PARTITION BY transactionNames) AS TotalSyncSLA, MAX( CASE WHEN CallType = 'Async' THEN SLAComparison ELSE 0 END ) OVER (PARTITION BY transactionNames) AS MaxAsyncSLA FROM ( SELECT ApplicationName, transactionNames, backendCall, CallType, SLA, releaseID, CASE WHEN CallType = 'Async' THEN ( SELECT MAX(SLA) FROM NFRDetails WHERE transactionNames = t.backendCall AND t.CallType = 'Async' and releaseID='2022.4') WHEN CallType = 'Sync' THEN ( SELECT SUM(SLA) FROM NFRDetails WHERE transactionNames = t.backendCall AND t.CallType = 'Sync' and releaseID='2022.4') ELSE 0 END AS SLAComparison FROM NFRDetails t where ApplicationName = 'OnlineBanking' and releaseID='2022.4' ) as x ) as p;